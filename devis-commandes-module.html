<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fresh Produce ERP - Réception</title>
    <!-- Use Tailwind CSS and the custom stylesheet -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide icons for a clean look -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="styles.css">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 font-sans text-gray-900">
    <!-- Sidebar for Main Navigation - Identical to the dashboard -->
    <aside class="sidebar p-4">
        <div class="text-2xl font-bold text-gray-800 mb-8 flex items-center gap-2">
            <span class="text-green-500">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-apple"><path d="M12 20.94a1.8 1.8 0 0 1-2.48.51c-1.39-1.2-2.18-2.6-3.13-4C5.17 14.76 4 13.11 4 11a4 4 0 0 1 8-2 4 4 0 0 1 8 2c0 2.11-1.17 3.76-2.39 5.45-1 1.39-1.79 2.79-3.13 4a1.8 1.8 0 0 1-2.48-.51z"/><path d="M10 2v3a1 1 0 0 1-2 0V2"/></svg>
            </span>
            <span>ERP System</span>
        </div>
        <nav>
            <ul>
                <li><a href="index.html" class="module-link rounded-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 13.5V4a2 2 0 0 1 2-2h8.5L20 7.5V20a2 2 0 0 1-2 2h-5.5"/><polyline points="14 2 14 8 20 8"/><path d="M10 17a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/><path d="M7 16.5v4.5"/><path d="M13 16.5v4.5"/></svg>
                    Dashboard
                </a></li>
                <li><a href="reception-module.html" class="module-link active rounded-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                    Réception
                </a></li>
                <li><a href="devis-commandes-module.html" class="module-link rounded-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    Devis et Commandes
                </a></li>
                <li><a href="stock-m.html" class="module-link rounded-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="20" x="2" y="2" rx="2" ry="2"/><path d="M12 2v20"/><path d="M2 12h20"/></svg>
                    Stock
                </a></li>
                <li><a href="palettisation-pal.html" class="module-link rounded-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4a2 2 0 0 0 1-1.73z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" x2="12" y1="22.01" y2="12"/></svg>
                    Palettisation
                </a></li>
                <li><a href="expedition-prep.html" class="module-link rounded-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.74 1.74"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.74-1.74"/></svg>
                    Expédition
                </a></li>
                <li><a href="ventes.html" class="module-link rounded-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s2-4 10-4 10 4 10 4-2 4-10 4-10-4-10-4z"/><circle cx="12" cy="12" r="3"/></svg>
                    Vente
                </a></li>
                <li><a href="qualite.html" class="module-link rounded-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19.07 4.93a10 10 0 0 1 0 14.14m-1.39 1.39a10 10 0 0 1-14.14 0m1.39-1.39a10 10 0 0 1 14.14 0m-1.39-1.39a10 10 0 0 1 0-14.14M5 19l14-14m-14 0l14 14"/></svg>
                    Qualité
                </a></li>
                <li><a href="comptabilite.html" class="module-link rounded-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20a8 8 0 0 1-8-8c0-5.45 4.31-9.9 9.81-10c2.42-.04 4.8.78 6.64 2.27A10.3 10.3 0 0 1 22 10"/><path d="M2 13a10.32 10.32 0 0 0 5.25 8.85c1.45.82 3.12 1.25 4.85 1.15a12.83 12.83 0 0 0 5.48-1.54"/><path d="M16 14h6"/><path d="M19 11v6"/></svg>
                    Comptabilité
                </a></li>
                <li><a href="ressourceshumaines.html" class="module-link rounded-md">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    Ressources Humaines
                </a></li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold text-gray-900">Devis et commandes</h1>
        </header>

        <!-- Top-level navigation for different tasks -->
        <nav class="bg-white p-4 rounded-lg card mb-6">
            <ul class="flex space-x-4">
                <li><a href="#saisie-devis" id="saisie-devis-tab" class="top-tab-link text-gray-900 font-medium hover:text-green-600 border-b-2 border-green-500">Devis</a></li>
                <li><a href="#saisie-bcommandes" id="saisie-bcommandes-tab" class="top-tab-link text-gray-500 hover:text-gray-900 border-b-2 border-transparent">Bons de commandes</a></li>
                <li><a href="#saisie-remboursements" id="saisie-remboursements-tab" class="top-tab-link text-gray-500 hover:text-gray-900 border-b-2 border-transparent">Remboursements</a></li>
            </ul>
        </nav>

        <!-- Top-level content sections container -->
        <div id="tab-content-container">
            <!-- Saisie des devis content section -->
            <div id="saisie-devis-content" class="tab-content">
                <div class="table-group-container grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Form: Devis -->
                    <div class="bg-white p-6 rounded-lg card">
                        <table class="w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th scope="col" colspan="2" class="px-6 py-3 text-center">Devis</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">N°Devis:</td>
                                    <td class="px-6 py-4"><input type="text" id="n-devis" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"></td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">N°Fournisseur:</td>
                                    <td class="px-6 py-4"><input type="text" id="n-frn" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"></td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">Quantité:</td>
                                    <td class="px-6 py-4"><input type="number" id="qnt" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"></td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">Mantant:</td>
                                    <td class="px-6 py-4"><input type="number" id="mnt" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"></td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">Date de livraison:</td>
                                    <td class="px-6 py-4"><input type="datetime-local" id="dte-livr" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"></td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">Lieu de livraison:</td>
                                    <td class="px-6 py-4"><input type="text" id="lieu-livr" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"></td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">Date de devis:</td>
                                    <td class="px-6 py-4"><input type="datetime-local" id="dte-devis" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                </div>
                <!-- Buttons for devis forms -->
                <div class="flex justify-end gap-4 mb-6">
                    <button class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                        Nouveau
                    </button>
                    <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                        Enregistrer
                    </button>
                    <button class="bg-gray-300 hover:bg-red-400 text-gray-800 font-bold py-2 px-4 rounded-lg transition-colors">
                        Annuler
                    </button>
                    <button class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg transition-colors">
                        Actualiser
                    </button>
                </div>
            </div>

            <!-- Saisie des remboursements content section -->
            <div id="saisie-remboursements-content" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Form: Saisie des remboursements (reorganized) -->
                    <div class="bg-white p-6 rounded-lg card">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Saisie des remboursements</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Each div is a form group for a label and input -->
                            <div>
                                <label for="identifiant-facture" class="block text-sm font-medium text-gray-700 mb-1">N°Facture:</label>
                                <input type="text" id="n-facture" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5">
                            </div>
                            <div>
                                <label for="n-bc-facture" class="block text-sm font-medium text-gray-700 mb-1">Mode paiement:</label>
                                <input type="number" id="mde-payment" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5">
                            </div>
                            <div>
                                <label for="n-facture-fournisseur" class="block text-sm font-medium text-gray-700 mb-1">Opérateur:</label>
                                <input type="text" id="nom-oper" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5">
                            </div>
                            <div>
                                <label for="montant-facture" class="block text-sm font-medium text-gray-700 mb-1">N°Document(LC/Cheque):</label>
                                <input type="number" id="n-doc-payment" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5">
                            </div>
                            <div>
                                <label for="rrr-percent" class="block text-sm font-medium text-gray-700 mb-1">Montant:</label>
                                <input type="number" id="mnt" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5">
                            </div>
                            <div>
                                <label for="net-commercial" class="block text-sm font-medium text-gray-700 mb-1">Echéance:</label>
                                <input type="number" id="net-commercial" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5">
                            </div>
                            <div>
                                <label for="escompte-percent" class="block text-sm font-medium text-gray-700 mb-1">Bordereau(PDF):</label>
                                <input type="file" id="bordereau" accept="image/*, application/pdf" class="hidden">
                            </div>
                            <div>
                                <label for="date-facture" class="block text-sm font-medium text-gray-700 mb-1">Date:</label>
                                <input type="datetime-local" id="date-remb" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5">
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Buttons for facture form -->
                <div class="flex justify-end gap-4 mb-6">
                    <button class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                        Nouveau
                    </button>
                    <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                        Enregistrer
                    </button>
                    <button class="bg-gray-300 hover:bg-red-400 text-gray-800 font-bold py-2 px-4 rounded-lg transition-colors">
                        Annuler
                    </button>
                </div>
            </div>

            <!-- bons de commandes content section -->
            <div id="saisie-bcommandes-content" class="tab-content hidden">
              <div class="table-group-container grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                  <!-- Form: Bon commandes -->
                  <div class="bg-white p-6 rounded-lg card">
                      <table class="w-full text-sm text-left text-gray-500">
                          <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                              <tr>
                                  <th scope="col" colspan="2" class="px-6 py-3 text-center">Bon de commande</th>
                              </tr>
                          </thead>
                          <tbody>
                              <tr class="bg-white border-b">
                                  <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">N°Bon de commande:</td>
                                  <td class="px-6 py-4"><input type="text" id="n-agr" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5" value="0000"></td>
                              </tr>
                              <tr class="bg-white border-b">
                                  <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">N°Fournisseur:</td>
                                  <td class="px-6 py-4"><input type="text" id="n-brp-agr" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"></td>
                              </tr>
                              <tr class="bg-white border-b">
                                  <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">Prix:</td>
                                  <td class="px-6 py-4"><input type="number" id="mnt" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"></td>
                              </tr>
                              <tr class="bg-white border-b">
                                  <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">Quantité(kg):</td>
                                  <td class="px-6 py-4"><input type="number" id="mnt" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"></td>
                              </tr>
                              <tr class="bg-white border-b">
                                  <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">Lieu de livraison:</td>
                                  <td class="px-6 py-4"><input type="text" id="tlle-ech" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"></td>
                              </tr>
                              <tr class="bg-white border-b">
                                  <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">Date de bon de commande:</td>
                                  <td class="px-6 py-4"><input type="datetime-local" id="dte-devis" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5"></td>
                              </tr>
                          </tbody>
                      </table>
                  </div>
              </div>
              <!-- Buttons for bon de commande -->
              <div class="flex justify-end gap-4 mb-6">
                  <button class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                      Nouveau
                  </button>
                  <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                      Enregistrer
                  </button>
                  <button class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg transition-colors">
                      Annuler
                  </button>
              </div>

            </div>

            <!-- This is the dynamic icon you can click to open the viewer -->
            <!-- You can place this SVG icon anywhere in your main HTML file -->
            <div id="open-viewer-btn" class="fixed top-4 right-4 z-50 p-3 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg transition-colors cursor-pointer">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
            </div>
            <!-- The dynamic modal window itself -->
            <div id="docViewerModal" class="flex flex-col bg-white border border-gray-300 w-[700px] h-[500px]">
                <!-- Modal Header for Dragging -->
                <div id="modal-header" class="flex justify-between items-center bg-gray-50 p-4 border-b border-gray-200 no-select">
                    <h4 class="text-sm font-semibold text-gray-700">Visionneuse de documents</h4>
                    <div class="flex items-center space-x-2">
                        <!-- File upload button -->
                        <label for="file-input" class="cursor-pointer text-blue-600 hover:text-blue-800 text-sm font-medium">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M10 2a.75.75 0 01.75.75v6.5a.75.75 0 01-1.5 0V2.75A.75.75 0 0110 2z" />
                                <path fill-rule="evenodd" d="M5.25 15a.75.75 0 01.75.75v.5a1.5 1.5 0 001.5 1.5h5a1.5 1.5 0 001.5-1.5v-.5a.75.75 0 011.5 0v.5a3 3 0 01-3 3h-5a3 3 0 01-3-3v-.5a.75.75 0 01.75-.75z" clip-rule="evenodd" />
                            </svg>
                            Importer
                        </label>
                        <input type="file" id="file-input" accept="image/*, application/pdf" class="hidden">
                        <!-- Close Button -->
                        <button id="close-modal-btn" class="text-gray-500 hover:text-gray-900 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Modal Content for File Display -->
                <div id="modal-content" class="flex-grow p-4 overflow-auto relative flex items-center justify-center">
                    <div id="file-viewer" class="w-full h-full text-center text-gray-400 flex items-center justify-center">
                        Aucun fichier sélectionné
                    </div>
                    <img id="image-preview" class="hidden max-w-full max-h-full object-contain" alt="Aperçu du document">
                    <iframe id="pdf-preview" class="hidden w-full h-full" title="Aperçu du PDF"></iframe>
                </div>

                <!-- Resize Handle -->
                <div id="resize-handle" class="resize-handle"></div>
            </div>
        </div>

        <!-- THE LISTES SECTION - This now dynamically changes its content based on the active main tab -->
        <hr class="my-8 border-t border-gray-300" />
        <h2 class="text-3xl font-bold text-gray-900 mb-4" id="listes-title">Listes</h2>

        <div id="lists-container">
            <!-- This container will hold the appropriate lists for the active main tab -->

            <!-- Lists for "Saisie des devis" -->
            <div id="saisie-devis-lists-content" class="list-content">
                <nav class="bg-white p-4 rounded-lg card mb-6">
                    <ul class="flex space-x-4">
                        <li><a href="#devis-list" id="devis-list-tab" class="bottom-tab-link text-gray-900 font-medium hover:text-green-600 border-b-2 border-green-500">Liste des devis</a></li>
                    </ul>
                </nav>
                <div id="devis-list-table" class="bottom-tab-table active-table">
                    <!-- Main table of devis -->
                    <div class="bg-white p-6 rounded-lg card shadow-xl">
                        <!-- <h2 class="text-lg font-semibold text-gray-900 mb-4">Liste des Devis</h2>-->
                        <div class="relative overflow-x-auto rounded-lg border border-gray-200">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <!-- Checkbox for selection -->
                                        <th scope="col" class="p-4">
                                            <div class="flex items-center">
                                                <input id="selectAll" type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="selectAll" class="sr-only">Sélectionner tout</label>
                                            </div>
                                        </th>
                                        <th scope="col" class="px-6 py-3">N°Devis</th>
                                        <th scope="col" class="px-6 py-3">N°Fournisseur</th>
                                        <th scope="col" class="px-6 py-3">Nom Fournisseur</th>
                                        <!-- I've added a placeholder column for the email, which would normally come from your data -->
                                        <th scope="col" class="px-6 py-3 hidden md:table-cell">Email Fournisseur</th>
                                        <th scope="col" class="px-6 py-3">N°Article</th>
                                        <th scope="col" class="px-6 py-3">Nom Article</th>
                                        <th scope="col" class="px-6 py-3">Quantité devis(Kg)</th>
                                        <th scope="col" class="px-6 py-3">Prix Devis</th>
                                        <th scope="col" class="px-6 py-3">Montant Devis</th>
                                        <th scope="col" class="px-6 py-3">Situation</th>
                                    </tr>
                                </thead>
                                <tbody id="devis-table-body">
                                    <!-- Example rows with data-email attribute for demo purposes -->
                                    <tr class="bg-white border-b hover:bg-gray-50">
                                        <td class="w-4 p-4">
                                            <div class="flex items-center">
                                                <input type="checkbox" data-name="Fournisseur A" data-email="fournisseurA@example.com" class="row-checkbox w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="checkbox-table-1" class="sr-only">checkbox</label>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">1</td>
                                        <td class="px-6 py-4">F-101</td>
                                        <td class="px-6 py-4">Fournisseur A</td>
                                        <td class="px-6 py-4 hidden md:table-cell">fournisseurA@example.com</td>
                                        <td class="px-6 py-4">A-123</td>
                                        <td class="px-6 py-4">Article Alpha</td>
                                        <td class="px-6 py-4">100</td>
                                        <td class="px-6 py-4">12.50</td>
                                        <td class="px-6 py-4">1250.00</td>
                                        <td class="px-6 py-4">envoyé</td>
                                    </tr>
                                    <tr class="bg-white border-b hover:bg-gray-50">
                                        <td class="w-4 p-4">
                                            <div class="flex items-center">
                                                <input type="checkbox" data-name="Fournisseur B" data-email="fournisseurB@example.com" class="row-checkbox w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="checkbox-table-2" class="sr-only">checkbox</label>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">2</td>
                                        <td class="px-6 py-4">F-102</td>
                                        <td class="px-6 py-4">Fournisseur B</td>
                                        <td class="px-6 py-4 hidden md:table-cell">fournisseurB@example.com</td>
                                        <td class="px-6 py-4">B-456</td>
                                        <td class="px-6 py-4">Article Beta</td>
                                        <td class="px-6 py-4">250</td>
                                        <td class="px-6 py-4">8.75</td>
                                        <td class="px-6 py-4">2187.50</td>
                                        <td class="px-6 py-4">accepté</td>
                                    </tr>
                                    <tr class="bg-white border-b hover:bg-gray-50">
                                        <td class="w-4 p-4">
                                            <div class="flex items-center">
                                                <input type="checkbox" data-name="Fournisseur C" data-email="fournisseurC@example.com" class="row-checkbox w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                                                <label for="checkbox-table-3" class="sr-only">checkbox</label>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">3</td>
                                        <td class="px-6 py-4">F-103</td>
                                        <td class="px-6 py-4">Fournisseur C</td>
                                        <td class="px-6 py-4 hidden md:table-cell">fournisseurC@example.com</td>
                                        <td class="px-6 py-4">C-789</td>
                                        <td class="px-6 py-4">Article Gamma</td>
                                        <td class="px-6 py-4">50</td>
                                        <td class="px-6 py-4">25.00</td>
                                        <td class="px-6 py-4">1250.00</td>
                                        <td class="px-6 py-4">rejeté</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Email Icon Button (initially hidden) -->
                <div id="email-button" class="fixed bottom-8 right-8 z-50 p-4 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg cursor-pointer transform scale-0 transition-transform duration-300 ease-in-out">
                    <i class="fas fa-envelope h-6 w-6 flex items-center justify-center"></i>
                </div>

                <!-- Email Modal (initially hidden) -->
                <div id="email-modal" class="email-modal fixed inset-0 z-50 hidden">
                    <div id="modal-overlay" class="modal-overlay absolute inset-0"></div>
                    <!-- Modal content with drag handle and resize handle -->
                    <!-- The modal now has an explicit width and height set in the style attribute for drag/resize to work correctly -->
                    <div id="modal-content" class="modal-content absolute bg-white p-0 rounded-xl shadow-2xl" style="width: 700px; height: 500px;">
                        <!-- Modal Header for dragging -->
                        <div id="modal-header" class="modal-header flex justify-between items-center bg-gray-50 p-4 border-b border-gray-200 rounded-t-xl">
                            <h3 class="text-xl font-bold text-gray-800">Envoyer un email aux fournisseurs</h3>
                            <button id="close-email-modal" class="text-gray-400 hover:text-gray-600 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>

                        <!-- Modal Body -->
                        <div class="p-6">
                            <div class="mb-4">
                                <label for="recipients" class="block text-sm font-medium text-gray-700">Destinataires</label>
                                <input type="text" id="recipients" class="mt-1 p-2 w-full border border-gray-300 rounded-md bg-gray-100" readonly>
                            </div>
                            <div class="mb-4">
                                <label for="email-subject" class="block text-sm font-medium text-gray-700">Sujet</label>
                                <input type="text" id="email-subject" class="mt-1 p-2 w-full border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="mb-4">
                                <label for="email-body" class="block text-sm font-medium text-gray-700">Corps du message</label>
                                <textarea id="email-body" rows="6" class="mt-1 p-2 w-full border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                            <div class="flex justify-end">
                                <button id="send-email-btn" class="px-6 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors">
                                    Envoyer
                                </button>
                            </div>
                        </div>

                        <!-- Resize handle -->
                        <div id="resize-handle" class="resize-handle"></div>
                    </div>
                </div>
            </div>
            <!-- Lists for "Saisie des bcommandes" -->
            <div id="saisie-bcommandes-lists-content" class="list-content hidden">
                <div class="bg-white p-6 rounded-lg card mt-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Bons de commandes</h3>
                    <div class="relative overflow-x-auto rounded-lg">
                        <table class="w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3">N°Bon de commande</th>
                                    <th scope="col" class="px-6 py-3">N°Devis</th>
                                    <th scope="col" class="px-6 py-3">Date devis</th>
                                    <th scope="col" class="px-6 py-3">N°Fournisseur</th>
                                    <th scope="col" class="px-6 py-3">Nom Fournisseur	</th>
                                    <th scope="col" class="px-6 py-3">N°Article</th>
                                    <th scope="col" class="px-6 py-3">Nom Article</th>
                                    <th scope="col" class="px-6 py-3">Quantité BC(Kg)</th>
                                    <th scope="col" class="px-6 py-3">Prix BC</th>
                                    <th scope="col" class="px-6 py-3">Montant BC</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white border-b hover:bg-gray-50">
                                    <td class="px-6 py-4">...</td>
                                    <td class="px-6 py-4">...</td>
                                    <td class="px-6 py-4">...</td>
                                    <td class="px-6 py-4">...</td>
                                    <td class="px-6 py-4">...</td>
                                    <td class="px-6 py-4">...</td>
                                    <td class="px-6 py-4">...</td>
                                    <td class="px-6 py-4">...</td>
                                    <td class="px-6 py-4">...</td>
                                    <td class="px-6 py-4">...</td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr class="bg-gray-50 font-bold text-gray-900">
                                    <td class="px-6 py-4" colspan="9">Total</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Lists for "remboursements" -->
            <div id="saisie-remboursements-lists-content" class="list-content">
                <nav class="bg-white p-4 rounded-lg card mb-6">
                    <ul class="flex space-x-4">
                        <li><a href="#remboursements-list" id="remboursements-list-tab" class="bottom-tab-link text-gray-900 font-medium hover:text-green-600 border-b-2 border-green-500">Liste des remboursements</a></li>
                        <li><a href="#tb-réglements-list" id="tb-réglements-list-tab" class="bottom-tab-link text-gray-500 hover:text-gray-900 border-b-2 border-transparent">Tableau de board réglements</a></li>
                    </ul>
                </nav>

                <div id="remboursements-list-table" class="bottom-tab-table active-table">
                    <!-- Main table of remboursements -->
                    <div class="bg-white p-6 rounded-lg card">
                        <div class="relative overflow-x-auto rounded-lg">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Date Remboursement</th>
                                        <th scope="col" class="px-6 py-3">N°Remboursement</th>
                                        <th scope="col" class="px-6 py-3">N°Facture</th>
                                        <th scope="col" class="px-6 py-3">Montant Remboursement</th>
                                        <th scope="col" class="px-6 py-3">Mode Paiment</th>
                                        <th scope="col" class="px-6 py-3">Echéance</th>
                                        <th scope="col" class="px-6 py-3">Operateur</th>
                                        <th scope="col" class="px-6 py-3">N°Document(LC/chéque)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="bg-white border-b hover:bg-gray-50">
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="tb-réglements-list-table" class="bottom-tab-table hidden">
                    <!-- Main table of réglements -->
                    <div class="bg-white p-6 rounded-lg card">
                        <div class="relative overflow-x-auto rounded-lg">
                            <table class="w-full text-sm text-left text-gray-500">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3">Date Facture</th>
                                        <th scope="col" class="px-6 py-3">N°Facture</th>
                                        <th scope="col" class="px-6 py-3">Nom Fournisseur</th>
                                        <th scope="col" class="px-6 py-3">N°Article	</th>
                                        <th scope="col" class="px-6 py-3">Nom Article	</th>
                                        <th scope="col" class="px-6 py-3">Montant Commandes</th>
                                        <th scope="col" class="px-6 py-3">Retours</th>
                                        <th scope="col" class="px-6 py-3">RRR</th>
                                        <th scope="col" class="px-6 py-3">Escompte</th>
                                        <th scope="col" class="px-6 py-3">Réglements</th>
                                        <th scope="col" class="px-6 py-3">Pourcentage</th>
                                        <th scope="col" class="px-6 py-3">Echéance remboursement</th>
                                        <th scope="col" class="px-6 py-3">Nombre Jours</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="bg-white border-b hover:bg-gray-50">
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                        <td class="px-6 py-4">...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // A helper function to manage tab states
            function activateTab(tabs, contents, activeTabLink, activeContent, hideListTitle = false) {
                tabs.forEach(t => {
                    t.classList.remove('border-green-500', 'text-gray-900', 'font-medium');
                    t.classList.add('border-transparent', 'text-gray-500');
                });
                activeTabLink.classList.add('border-green-500', 'text-gray-900', 'font-medium');
                activeTabLink.classList.remove('border-transparent', 'text-gray-500');

                contents.forEach(content => content.classList.add('hidden'));
                if (activeContent) {
                    activeContent.classList.remove('hidden');
                }

                const listesTitle = document.getElementById('listes-title');
                if (hideListTitle) {
                    listesTitle.classList.add('hidden');
                } else {
                    listesTitle.classList.remove('hidden');
                }
            }

            function setupTopTabs() {
                const topTabs = document.querySelectorAll('.top-tab-link');
                const mainContents = document.querySelectorAll('.tab-content');
                const listContents = document.querySelectorAll('.list-content');

                topTabs.forEach(tab => {
                    tab.addEventListener('click', function(e) {
                        e.preventDefault();
                        const mainContentId = this.getAttribute('href').substring(1) + '-content';
                        const listContentId = this.getAttribute('href').substring(1) + '-lists-content';

                        const activeMainContent = document.getElementById(mainContentId);
                        const activeListContent = document.getElementById(listContentId);

                        const hideListTitle = !activeListContent || activeListContent.children.length === 0;
                        activateTab(topTabs, mainContents, this, activeMainContent, hideListTitle);
                        activateTab(topTabs, listContents, this, activeListContent);

                        // Special handling for the bottom tabs within 'Saisie des remboursements'
                        if (mainContentId === 'saisie-remboursements-content') {
                            const remboursementsListTab = document.getElementById('remboursements-list-tab');
                            if(remboursementsListTab) {
                                remboursementsListTab.click();
                            }
                        }
                        if (mainContentId === 'saisie-devis-content') {
                            const devisListTab = document.getElementById('devis-list-tab');
                            if(devisListTab) {
                                devisListTab.click();
                            }
                        }
                    });
                });
            }

            function setupBottomTabs() {
                const bottomTabs = document.querySelectorAll('.bottom-tab-link');
                const bottomTables = document.querySelectorAll('.bottom-tab-table');

                bottomTabs.forEach(tab => {
                    tab.addEventListener('click', function(e) {
                        e.preventDefault();

                        bottomTabs.forEach(t => {
                            t.classList.remove('border-green-500', 'text-gray-900', 'font-medium');
                            t.classList.add('border-transparent', 'text-gray-500');
                        });
                        this.classList.add('border-green-500', 'text-gray-900', 'font-medium');
                        this.classList.remove('border-transparent', 'text-gray-500');

                        bottomTables.forEach(table => {
                            table.classList.add('hidden');
                        });

                        const targetId = this.getAttribute('href').substring(1) + '-table';
                        const targetTable = document.getElementById(targetId);
                        if (targetTable) {
                            targetTable.classList.remove('hidden');
                        }
                    });
                });
            }

            /*function setupInvoiceUploader() {
                const fileInput = document.getElementById('invoice-file-input');
                const viewerContainer = document.getElementById('invoice-viewer-container');
                const imageViewer = document.getElementById('invoice-image-viewer');
                const pdfViewer = document.getElementById('invoice-pdf-viewer');
                const removeButton = document.getElementById('remove-file-button');
                const placeholder = document.getElementById('placeholder-message');

                fileInput.addEventListener('change', function() {
                    const file = this.files[0];
                    if (file) {
                        const fileURL = URL.createObjectURL(file);
                        viewerContainer.classList.remove('hidden');
                        removeButton.classList.remove('hidden');
                        placeholder.classList.add('hidden');

                        if (file.type.startsWith('image/')) {
                            imageViewer.src = fileURL;
                            imageViewer.classList.remove('hidden');
                            pdfViewer.classList.add('hidden');
                        } else if (file.type === 'application/pdf') {
                            pdfViewer.src = fileURL;
                            pdfViewer.classList.remove('hidden');
                            imageViewer.classList.add('hidden');
                        } else {
                            // Handle unsupported file types if needed
                            alert('Format de fichier non pris en charge. Veuillez sélectionner une image ou un PDF.');
                            removeFile();
                        }
                    }
                });

                removeButton.addEventListener('click', removeFile);

                function removeFile() {
                    fileInput.value = ''; // Clear the file input
                    imageViewer.src = '';
                    pdfViewer.src = '';
                    viewerContainer.classList.add('hidden');
                    removeButton.classList.add('hidden');
                    placeholder.classList.remove('hidden');
                    // Revoke the object URL to free up memory
                    if (imageViewer.src) URL.revokeObjectURL(imageViewer.src);
                    if (pdfViewer.src) URL.revokeObjectURL(pdfViewer.src);
                }
            }*/

            setupTopTabs();
            setupBottomTabs();
            //setupInvoiceUploader();

            // Initial state: click the first tab to set everything up
            document.getElementById('saisie-devis-tab').click();
        });


        // --- DOM Elements ---
         const openBtn = document.getElementById('open-viewer-btn');
         const modal = document.getElementById('docViewerModal');
         const closeBtn = document.getElementById('close-modal-btn');
         const modalHeader = document.getElementById('modal-header');
         const fileInput = document.getElementById('file-input');
         const imagePreview = document.getElementById('image-preview');
         const pdfPreview = document.getElementById('pdf-preview');
         const fileViewerPlaceholder = document.getElementById('file-viewer');
         const resizeHandle = document.getElementById('resize-handle');

         // --- Dragging Functionality ---
         let isDragging = false;
         let initialX, initialY;
         let xOffset = 0, yOffset = 0;

         modalHeader.addEventListener('mousedown', dragStart);

         function dragStart(e) {
             isDragging = true;
             modal.classList.add('dragging');
             initialX = e.clientX - xOffset;
             initialY = e.clientY - yOffset;
             document.addEventListener('mousemove', drag);
             document.addEventListener('mouseup', dragEnd);
         }

         function drag(e) {
             if (isDragging) {
                 e.preventDefault();
                 xOffset = e.clientX - initialX;
                 yOffset = e.clientY - initialY;
                 setTranslate(xOffset, yOffset, modal);
             }
         }

         function dragEnd() {
             isDragging = false;
             modal.classList.remove('dragging');
             document.removeEventListener('mousemove', drag);
             document.removeEventListener('mouseup', dragEnd);
         }

         function setTranslate(xPos, yPos, el) {
             el.style.transform = `translate(${xPos}px, ${yPos}px)`;
         }

         // --- Resizing Functionality ---
         let isResizing = false;
         let initialWidth, initialHeight;

         resizeHandle.addEventListener('mousedown', resizeStart);

         function resizeStart(e) {
             e.stopPropagation(); // Prevents dragging from starting at the same time
             isResizing = true;
             modal.classList.add('resizing');
             initialX = e.clientX;
             initialY = e.clientY;
             initialWidth = modal.offsetWidth;
             initialHeight = modal.offsetHeight;
             document.addEventListener('mousemove', resize);
             document.addEventListener('mouseup', resizeEnd);
         }

         function resize(e) {
             if (isResizing) {
                 const newWidth = initialWidth + (e.clientX - initialX);
                 const newHeight = initialHeight + (e.clientY - initialY);
                 modal.style.width = `${newWidth}px`;
                 modal.style.height = `${newHeight}px`;
             }
         }

         function resizeEnd() {
             isResizing = false;
             modal.classList.remove('resizing');
             document.removeEventListener('mousemove', resize);
             document.removeEventListener('mouseup', resizeEnd);
         }

         // --- File Handling Functionality ---
         fileInput.addEventListener('change', (event) => {
             const file = event.target.files[0];
             if (file) {
                 fileViewerPlaceholder.classList.add('hidden');
                 const fileUrl = URL.createObjectURL(file);
                 if (file.type.startsWith('image/')) {
                     imagePreview.src = fileUrl;
                     imagePreview.classList.remove('hidden');
                     pdfPreview.classList.add('hidden');
                 } else if (file.type === 'application/pdf') {
                     pdfPreview.src = fileUrl;
                     pdfPreview.classList.remove('hidden');
                     imagePreview.classList.add('hidden');
                 } else {
                     fileViewerPlaceholder.textContent = 'Type de fichier non supporté.';
                     fileViewerPlaceholder.classList.remove('hidden');
                     imagePreview.classList.add('hidden');
                     pdfPreview.classList.add('hidden');
                 }
             }
         });

         // --- Modal Visibility ---
         openBtn.addEventListener('click', () => {
             modal.style.display = 'flex';
         });

         closeBtn.addEventListener('click', () => {
             modal.style.display = 'none';
         });

       //===> Mail box ==
          document.addEventListener('DOMContentLoaded', () => {
          const tableBody = document.getElementById('devis-table-body');
          const selectAllCheckbox = document.getElementById('selectAll');
          const emailButton = document.getElementById('email-button');
          const emailModal = document.getElementById('email-modal');
          const modalContent = document.getElementById('modal-content');
          const modalOverlay = document.getElementById('modal-overlay');
          const modalHeader = document.getElementById('modal-header');
          const resizeHandle = document.getElementById('resize-handle');
          const closeEmailModalBtn = document.getElementById('close-email-modal');
          const recipientsInput = document.getElementById('recipients');
          const sendEmailBtn = document.getElementById('send-email-btn');

          let isDragging = false;
          let isResizing = false;
          let offset = { x: 0, y: 0 };

          // Function to update the email button's visibility
          function updateEmailButtonVisibility() {
              const selectedRows = document.querySelectorAll('.row-checkbox:checked');
              if (selectedRows.length > 0) {
                  emailButton.classList.remove('scale-0');
                  emailButton.classList.add('scale-100');
              } else {
                  emailButton.classList.remove('scale-100');
                  emailButton.classList.add('scale-0');
              }
          }

          // Function to handle opening the modal
          function openEmailModal() {
              const selectedRows = document.querySelectorAll('.row-checkbox:checked');
              const recipients = [];

              selectedRows.forEach(checkbox => {
                  const email = checkbox.dataset.email;
                  if (email) recipients.push(email);
              });

              if (recipients.length > 0) {
                  recipientsInput.value = recipients.join(', ');
              }

              emailModal.classList.remove('hidden');
              setTimeout(() => {
                  emailModal.classList.add('modal-active');
              }, 10);
          }

          // Function to handle closing the modal
          function closeEmailModal() {
              emailModal.classList.remove('modal-active');
              setTimeout(() => {
                  emailModal.classList.add('hidden');
              }, 300);
          }

          // --- Dragging functionality ---
          modalHeader.addEventListener('mousedown', (e) => {
              isDragging = true;
              const modalRect = modalContent.getBoundingClientRect();
              offset.x = e.clientX - modalRect.left;
              offset.y = e.clientY - modalRect.top;
              modalContent.style.transition = 'none'; // Disable transition during drag
          });

          // --- Resizing functionality ---
          resizeHandle.addEventListener('mousedown', (e) => {
              isResizing = true;
              e.preventDefault();
              e.stopPropagation(); // Prevent modal drag from starting
              modalContent.style.transition = 'none'; // Disable transition during resize
          });

          document.addEventListener('mousemove', (e) => {
              if (isDragging) {
                  modalContent.style.left = `${e.clientX - offset.x}px`;
                  modalContent.style.top = `${e.clientY - offset.y}px`;
              }

              if (isResizing) {
                  const newWidth = e.clientX - modalContent.getBoundingClientRect().left;
                  const newHeight = e.clientY - modalContent.getBoundingClientRect().top;
                  // Set minimum dimensions
                  modalContent.style.width = Math.max(newWidth, 400) + 'px';
                  modalContent.style.height = Math.max(newHeight, 300) + 'px';
              }
          });

          document.addEventListener('mouseup', () => {
              isDragging = false;
              isResizing = false;
              modalContent.style.transition = 'transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease'; // Re-enable transition
          });
          // --- End of Dragging and Resizing ---

          // Event listener for individual checkboxes
          tableBody.addEventListener('change', (e) => {
              if (e.target.classList.contains('row-checkbox')) {
                  updateEmailButtonVisibility();
              }
          });

          // Event listener for the "select all" checkbox
          selectAllCheckbox.addEventListener('change', (e) => {
              document.querySelectorAll('.row-checkbox').forEach(checkbox => {
                  checkbox.checked = e.target.checked;
              });
              updateEmailButtonVisibility();
          });

          // Event listener for the email button
          emailButton.addEventListener('click', openEmailModal);

          // Event listeners for closing the modal
          closeEmailModalBtn.addEventListener('click', closeEmailModal);
          modalOverlay.addEventListener('click', closeEmailModal);

          // Event listener for the "Send" button
          sendEmailBtn.addEventListener('click', () => {
              const recipients = recipientsInput.value;
              const subject = document.getElementById('email-subject').value;
              const body = document.getElementById('email-body').value;

              if (recipients && subject && body) {
                  // This is where you would integrate with a backend service to send the email
                  console.log('Sending email to:', recipients);
                  console.log('Subject:', subject);
                  console.log('Body:', body);
                  // Use a custom modal instead of alert
                  // For now, we will simulate the behavior
                  alert('Email sent successfully! (This is a simulation)');
                  closeEmailModal();
              } else {
                  alert('Veuillez remplir tous les champs.');
              }
          });
      });
    </script>
</body>
</html>
